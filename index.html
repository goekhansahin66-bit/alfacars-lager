<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alfacars â€“ Bestellungen Â· Kunden Â· Lager</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
</head>
<body>
  <div class="shell">
    <div class="topbar">
      <div>
        <div class="brand-title">Alfacars</div>
        <div class="brand-sub">Bestellungen Â· Kunden Â· Lager</div>
      </div>

      <div class="top-actions">
        <div class="search">
          <span class="icon">ðŸ”Ž</span>
          <input id="searchInput" placeholder="Suchen (Kunde, Telefon, Kennzeichen, GrÃ¶ÃŸe, Marke â€¦)" />
          <button class="ghost" id="clearSearch" title="Suche lÃ¶schen">âœ•</button>
        </div>

        <button class="btn primary" id="btnNew">+ Bestellung</button>
        <button class="btn soft" id="btnExportAll">Export</button>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="orders">Bestellungen</button>
      <button class="tab" data-tab="archive">Archiv</button>
      <button class="tab" data-tab="customers">Kunden</button>
      <button class="tab" data-tab="stock">Lager</button>
      <button class="tab" data-tab="bestellen">ðŸ“¦ Bestellen</button>
      <button class="tab" data-tab="staff">ðŸ‘¥ Mitarbeiter</button>
      <button class="tab" data-tab="notes">ðŸ§  Notizen / KI</button>
    </div>

    <!-- ===== ORDERS BOARD ===== -->
    <div class="board" id="ordersBoard">
      <div class="column">
        <div class="col-head">
          <div class="col-title"><span class="dot dot-grey"></span> Bestellt</div>
          <div class="col-count" id="count-Bestellt">0</div>
        </div>
        <div class="col-body" id="col-Bestellt"></div>
      </div>

      <div class="column">
        <div class="col-head">
          <div class="col-title"><span class="dot dot-yellow"></span> Anrufen</div>
          <div class="col-count" id="count-Anrufen">0</div>
        </div>
        <div class="col-body" id="col-Anrufen"></div>
      </div>

      <div class="column">
        <div class="col-head">
          <div class="col-title"><span class="dot dot-green"></span> Erledigt</div>
          <div class="col-count" id="count-Erledigt">0</div>
        </div>
        <div class="col-body" id="col-Erledigt"></div>
      </div>
    </div>

    <!-- ===== ARCHIVE BOARD ===== -->
    <div class="board hidden" id="archiveBoard">
      <div class="column" style="grid-column:1/-1;">
        <div class="col-head">
          <div class="col-title"><span class="dot dot-grey"></span> Archiv</div>
          <div class="col-count" id="count-Archiv">0</div>
        </div>
        <div class="col-body" id="col-Archiv"></div>
      </div>
    </div>

    <!-- ===== CUSTOMERS BOARD ===== -->
    <div class="board hidden" id="customerBoard">
      <div class="column" style="grid-column:1/-1;">
        <div class="col-head">
          <div class="col-title">Kunden</div>
          <div class="col-count" id="reachBox"></div>
        </div>

        <div class="col-body">
          <div class="search" style="box-shadow:none; margin-bottom:12px;">
            <span class="icon">ðŸ”Ž</span>
            <input id="customerSearchInput" placeholder="Kunden suchen (Name, Telefon, Kennzeichen â€¦)" />
          </div>

          <div id="customerList"></div>

          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn primary" id="btnNewCustomer">+ Kunde</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== STOCK BOARD ===== -->
    <div class="board hidden" id="stockBoard">
      <div class="column" style="grid-column:1/-1;">
        <div class="col-head">
          <div class="col-title">Lager</div>
          <div class="col-count"><span id="stockNeedCount">0</span> fehlen</div>
        </div>

        <div class="col-body">
          <div class="search" style="box-shadow:none; margin-bottom:12px;">
            <span class="icon">ðŸ”Ž</span>
            <input id="stockSearchInput" placeholder="Lager suchen (GrÃ¶ÃŸe, Marke, Saison, DOT â€¦)" />
          </div>

          <div id="stockNeedBox" class="note hidden"></div>
          <div id="stockList"></div>

          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn primary" id="btnNewStock">+ Lager</button>
          </div>

          <div class="hint" style="margin-top:10px;">
            Tipp: Read-Only nur mit <b>?ro=1</b>. Ohne Parameter ist Handy-Bearbeitung aktiv.
          </div>
        </div>
      </div>
    </div>

    <!-- ===== BESTELLEN BOARD ===== -->
    <div class="board hidden" id="bestellenBoard">
      <div class="column" style="grid-column:1/-1;">
        <div class="col-head">
          <div class="col-title">ðŸ“¦ Bestellliste</div>
          <div class="col-count" id="bestellenCount">0</div>
        </div>
        <div class="col-body">
          <div class="note list" style="margin-bottom:12px;">
            Automatisch aus dem Lager berechnet Â· Marken: <b>Syron</b>, <b>Berlin Tires</b> Â· Soll: <b>4</b>
            <div class="small-muted" id="bestellenSummary" style="margin-top:6px;"></div>
          </div>
          <div id="bestellenList"></div>
        </div>
      </div>
    </div>

    <!-- ===== STAFF BOARD ===== -->
    <div class="board hidden" id="staffBoard">
      <div class="column" style="grid-column:1/-1;">
        <div class="col-head">
          <div class="col-title">ðŸ‘¥ Mitarbeiter</div>
          <div class="col-count" id="staffMonthHint">â€”</div>
        </div>
        <div class="col-body">
          
          <div class="note list" style="margin-bottom:12px;">
            Zeiten automatisch: <b>Moâ€“Fr 08:00â€“18:00</b> Â· <b>Sa 08:00â€“16:00</b> Â· Bonus: ab dem <b>3. Samstag</b> im Monat <b>+8 â‚¬</b> (pro zusÃ¤tzlichem Samstag)
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px;">
            <div class="field" style="min-width:220px; flex:0 0 auto;">
              <label style="display:block; font-size:12px; color:var(--muted); font-weight:900; margin-bottom:6px;">Monat</label>
              <input id="staffMonth" type="month" />
              <div class="hint">FÃ¼r Bonus/Ãœbersicht.</div>
            </div>

            <div class="field" style="min-width:220px; flex:0 0 auto;">
              <label style="display:block; font-size:12px; color:var(--muted); font-weight:900; margin-bottom:6px;">Heute</label>
              <input id="staffDay" type="date" />
              <div class="hint">Status klicken: anwesend / krank / ab Uhrzeit / frÃ¼her.</div>
            </div>

            <div style="display:flex; align-items:flex-end; gap:8px; flex-wrap:wrap;">
              <button class="btn primary" id="btnAddStaff">+ Mitarbeiter</button>
              <button class="btn soft" id="btnStaffRefresh">Aktualisieren</button>
            </div>
          </div>

          <div id="staffTodayList"></div>

          <div class="card" style="margin-top:12px;">
            <div class="card-top">
              <div>
                <div class="card-title">MonatsÃ¼bersicht</div>
                <div class="card-sub">Anwesenheit Â· Krankheit Â· Samstage Â· Bonus</div>
              </div>
              <div class="pill small grey">nur du</div>
            </div>
            <div id="staffMonthSummary" style="margin-top:10px;"></div>
          </div>
</div>
      </div>
    </div>

    
    <!-- ===== NOTES BOARD ===== -->
    <div class="board hidden" id="notesBoard">
      <div class="column" style="grid-column:1/-1;">
        <div class="col-head">
          <div class="col-title">ðŸ§  Notizen / KI (mit BestÃ¤tigung)</div>
          <div class="col-count" id="notesCount">0</div>
        </div>

        <div class="col-body">
          <div class="note list" style="margin-bottom:12px;">
            Schreibe oder sprich wie mit ChatGPT. Die KI darf <b>nur VorschlÃ¤ge</b> machen â€“ du bestÃ¤tigst jede Aktion (Lager/Bestellung) per Klick.
          </div>

          <div class="search" style="box-shadow:none; margin-bottom:12px;">
            <span class="icon">ðŸ”Ž</span>
            <input id="notesSearchInput" placeholder="Notizen suchen (Text, Datum â€¦)" />
          </div>

          <div class="card" style="margin-bottom:12px;">
            <div class="card-top">
              <div>
                <div class="card-title">KI-Eingabe</div>
                <div class="card-sub">Beispiel: â€žIch habe Reifen reinbekommen: 225/55 R16 Berlin Tires Allwetter 4 StÃ¼ckâ€œ</div>
              </div>
              <div class="pill small grey">nur Vorschlag</div>
            </div>

            <div style="margin-top:10px;">
              <textarea id="aiInput" rows="4" style="width:100%; padding:10px; border-radius:14px; border:1px solid rgba(209,213,219,.9);"></textarea>
            </div>

            <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn primary" id="btnAiSend">Mit KI sprechen</button>
              <button class="btn soft" id="btnAiSaveNote">Als Notiz speichern</button>
              <button class="btn soft" id="btnAiClear">Leeren</button>
            </div>

            <div id="aiSuggestions" class="note list hidden" style="margin-top:10px;"></div>
            <div id="aiChatLog" style="margin-top:10px;"></div>
          </div>

          <div id="notesList"></div>
        </div>
      </div>
    </div>


<!-- ===== FOOTER ===== -->
    <div class="foot">
      <span class="muted" id="footStatus">Bereit</span>
    </div>
  </div>

  <!-- ===== Shared datalists ===== -->
  <datalist id="brandList"></datalist>
  <datalist id="modelList"></datalist>

  <!-- ================= ORDER MODAL ================= -->
  <div class="modal hidden" id="modal">
    <div class="modal-card">
      <div class="modal-head">
        <div>
          <div class="modal-title" id="modalTitle">Bestellung</div>
          <div class="modal-sub">Daten eingeben & speichern</div>
        </div>
        <button class="ghost big" id="btnClose">âœ•</button>
      </div>

      <div class="form-grid">
        <div class="field">
          <label>Kunde</label>
          <input id="f_name" placeholder="Name" />
          <div class="hint">Telefon/Kennzeichen helfen beim Wiederfinden.</div>
        </div>
        <div class="field">
          <label>Telefon</label>
          <input id="f_phone" placeholder="z.B. 0176..." />
        </div>

        <div class="field">
          <label>Kennzeichen</label>
          <input id="f_plate" placeholder="z.B. B-AB 1234" />
        </div>
        <div class="field">
          <label>E-Mail</label>
          <input id="f_email" placeholder="optional" />
        </div>

        <div class="field">
          <label>StraÃŸe</label>
          <input id="f_street" placeholder="optional" />
        </div>
        <div class="field">
          <label>PLZ</label>
          <input id="f_zip" placeholder="optional" />
        </div>

        <div class="field">
          <label>Ort</label>
          <input id="f_city" placeholder="optional" />
        </div>
        <div class="field">
          <label>Herkunft</label>
          <input id="f_source" placeholder="z.B. Empfehlung / Google" />
        </div>

        <div class="field">
          <label>ReifengrÃ¶ÃŸe</label>
          <input id="f_size" placeholder="z.B. 205/55 R16" />
        </div>
        <div class="field">
          <label>Marke</label>
          <input id="f_brand" list="brandList" placeholder="z.B. Michelin" />
        </div>

        <div class="field">
          <label>Saison</label>
          <select id="f_season">
            <option value="">Bitte wÃ¤hlen</option>
            <option>Sommer</option>
            <option>Winter</option>
            <option>Allwetter</option>
          </select>
        </div>
        <div class="field">
          <label>Modell</label>
          <input id="f_model" list="modelList" placeholder="optional" />
        </div>

        <div class="field">
          <label>Menge</label>
          <input id="f_qty" type="number" min="0" step="1" />
        </div>
        <div class="field">
          <label>Preis pro StÃ¼ck</label>
          <input id="f_unit" type="number" min="0" step="0.01" />
        </div>

        <div class="field">
          <label>Anzahlung</label>
          <input id="f_deposit" type="number" min="0" step="0.01" />
        </div>
        <div class="field">
          <label>Felgen</label>
          <input id="f_rims" placeholder="optional" />
        </div>

        <div class="field span-2">
          <label>Notiz</label>
          <textarea id="f_note" rows="3" placeholder="optional"></textarea>
        </div>

        <div class="field">
          <label>Status</label>
          <select id="f_status">
            <option>Bestellt</option>
            <option>Anrufen</option>
            <option>Erledigt</option>
            <option>Archiv</option>
          </select>
        </div>

        <div class="field">
          <label>Bestellquelle</label>
          <input id="f_orderSource" placeholder="z.B. Syron / Berlin Tires / ..." />
        </div>
      </div>

      <div class="calc-row">
        <div class="calc">
          <div class="calc-label">Gesamt</div>
          <div class="calc-value" id="calc_total">0,00 â‚¬</div>
        </div>
        <div class="calc">
          <div class="calc-label">Restbetrag</div>
          <div class="calc-value" id="calc_rest">0,00 â‚¬</div>
        </div>
      </div>

      <div class="modal-actions">
        <div class="left-actions">
          <button class="btn danger" id="btnDelete">LÃ¶schen</button>
        </div>
        <div class="right-actions">
          <button class="btn" id="btnCancel">Abbrechen</button>
          <button class="btn primary" id="btnSave">Speichern</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ================= CUSTOMER MODAL ================= -->
  <div class="modal hidden" id="customerModal">
    <div class="modal-card">
      <div class="modal-head">
        <div>
          <div class="modal-title" id="customerModalTitle">Kunde</div>
          <div class="modal-sub">Kundendaten</div>
        </div>
        <button class="ghost big" id="cbtnClose">âœ•</button>
      </div>

      <div class="form-grid">
        <div class="field"><label>Name</label><input id="c_name" /></div>
        <div class="field"><label>Telefon</label><input id="c_phone" /></div>

        <div class="field"><label>Kennzeichen</label><input id="c_plate" /></div>
        <div class="field"><label>E-Mail</label><input id="c_email" /></div>

        <div class="field"><label>StraÃŸe</label><input id="c_street" /></div>
        <div class="field"><label>PLZ</label><input id="c_zip" /></div>

        <div class="field"><label>Ort</label><input id="c_city" /></div>
        <div class="field"><label>Herkunft</label><input id="c_source" /></div>
      </div>

      <div class="modal-actions">
        <div class="left-actions">
          <button class="btn danger" id="cbtnDelete">LÃ¶schen</button>
        </div>
        <div class="right-actions">
          <button class="btn" id="cbtnCancel">Abbrechen</button>
          <button class="btn primary" id="cbtnSave">Speichern</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ================= STOCK MODAL ================= -->
  <div class="modal hidden" id="stockModal">
    <div class="modal-card">
      <div class="modal-head">
        <div>
          <div class="modal-title" id="stockModalTitle">Lager</div>
          <div class="modal-sub">Lagereintrag</div>
        </div>
        <button class="ghost big" id="sbtnClose">âœ•</button>
      </div>

      <div class="form-grid">
        <div class="field">
          <label>ReifengrÃ¶ÃŸe</label>
          <input id="s_size" placeholder="z.B. 205/55 R16" />
        </div>
        <div class="field">
          <label>Marke</label>
          <input id="s_brand" list="brandList" placeholder="z.B. Syron" />
        </div>

        <div class="field">
          <label>Saison</label>
          <select id="s_season">
            <option value="">Bitte wÃ¤hlen</option>
            <option>Sommer</option>
            <option>Winter</option>
            <option>Allwetter</option>
          </select>
        </div>
        <div class="field">
          <label>Modell</label>
          <input id="s_model" list="modelList" placeholder="optional" />
        </div>

        <div class="field">
          <label>DOT</label>
          <input id="s_dot" placeholder="optional" />
        </div>
        <div class="field">
          <label>Menge</label>
          <input id="s_qty" type="number" min="0" step="1" />
        </div>
      </div>

      <div class="modal-actions">
        <div class="left-actions">
          <button class="btn danger" id="s_delete">LÃ¶schen</button>
        </div>
        <div class="right-actions">
          <button class="btn" id="s_cancel">Abbrechen</button>
          <button class="btn primary" id="s_save">Speichern</button>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
